{"version":3,"sources":["../apiserver_dev/app.js"],"names":["app","keys","use","prefix","rolling","store","get","cookie","maxAge","httpOnly","signed","credentials","methods","charset","jsonLimit","ctx","next","start","Date","ms","fdate","format","console","log","method","url","on","err","routes","allowedMethods"],"mappings":"2UAAA,0B;;;AAGA,gC;AACA,0B;AACA,gC;AACA,yC;AACA,gC;AACA,wD;AACA,mE;;;;;;;;;;;;;;;;;;AAkBA,mC;;;;;;;;AAQA,yC;;;;;;;AAOA,+C;;;;;;;;;;;;;;;;;;;;AAoBA,mD;;;;;AAKA,oC,sIAlEA,IAAMA,MAAM,mBAAZ,C,CAWA;AACAA,IAAIC,IAAJ,GAAW,CAAC,QAAD,EAAW,KAAX,CAAX,C,CAA6B;AAC7BD,IAAIE,GAAJ,CAAQ,0BAAQ,iCAAQ,EACpBC,QAAQ,kBADY,EAEpBC,SAAS,IAFW,EAGpBC,OAAO,qCAAe,iBAAOC,GAAP,CAAW,SAAX,CAAf,CAHa,EAIpBC,QAAQ,EACJC,QAAQ,UAAU,EADd,EAEJC,UAAU,IAFN,EAGJC,QAAQ,IAHJ,EAJY,EAAR,CAAR,CAAR,E,CAYA;AAEAV,IAAIE,GAAJ,CAAQ,0BAAQ,uBAAK,EACjBS,aAAa,IADI,EACE;AACnBC,aAAS,CAAC,KAAD,EAAQ,KAAR,EAAe,MAAf,EAAuB,QAAvB,EAAiC,SAAjC,CAFQ,EAAL,CAAR,CAAR,E,CAMA;AAEAZ,IAAIE,GAAJ,CAAQ,0BAAQ,0BAAQ,EACpBW,SAAS,MADW,EAAR,CAAR,CAAR,E,CAKA;AAEAb,IAAIE,GAAJ,CAAQ,6BAAW,EAACY,WAAU,KAAX,EAAX,CAAR,EAGAd,IAAIE,GAAJ,oFAAQ,iBAAMa,GAAN,EAAWC,IAAX,iJACEC,KADF,GACU,IAAIC,IAAJ,EADV,0BAEEF,MAFF,QAGEG,EAHF,GAGO,IAAID,IAAJ,KAAaD,KAHpB,CAIEG,KAJF,GAIU,wBAASC,MAAT,CAAgB,qBAAhB,CAJV,CAMJC,QAAQC,GAAR,CAAeR,IAAIS,MAAnB,SAA6BT,IAAIU,GAAjC,WAA0CN,EAA1C,WAAkDC,KAAlD,EANI,mEAAR,wEAUApB,IAAI0B,EAAJ,CAAO,OAAP,EAAgB,UAAUC,GAAV,EAAeZ,GAAf,EAAoB,CAChCO,QAAQC,GAAR,CAAYI,GAAZ,EAAiB,wBAAjB,EACH,CAFD,E,CAKA;AAEA3B,IAAIE,GAAJ,CAAQ,0BAAQ,gCAAR,CAAR,E,CAGA;AAEAF,IAAIE,GAAJ,CAAQ,cAAU0B,MAAV,EAAR,EAA4B,cAAUC,cAAV,EAA5B,E,kBAEe7B,G","file":"app.js","sourcesContent":["import Koa from 'koa'\r\nconst app = new Koa()\r\n\r\nimport _ from 'lodash'\r\nimport url from 'url'\r\nimport config from 'config'\r\nimport convert from 'koa-convert'\r\nimport moment from 'moment'\r\nimport session from 'koa-generic-session'\r\nimport MongoStore from 'koa-generic-session-mongo'\r\n\r\n\r\n// koa session\r\napp.keys = ['fuwala', 'api'] // 若不加此方法，则存储session报错\r\napp.use(convert(session({\r\n    prefix: \"fuwala:software:\",\r\n    rolling: true,\r\n    store: new MongoStore(config.get(\"mongodb\")),\r\n    cookie: {\r\n        maxAge: 3600000 * 24,\r\n        httpOnly: true,\r\n        signed: true\r\n    }\r\n})))\r\n\r\n\r\n//koa 跨域\r\nimport cors from 'koa-cors'\r\napp.use(convert(cors({\r\n    credentials: true, // set Access-Control-Allow-Credentials to true\r\n    methods: ['GET', 'PUT', 'POST', 'DELETE', 'OPTIONS']\r\n})))\r\n\r\n\r\n// koa字符集\r\nimport charset from 'koa-charset'\r\napp.use(convert(charset({\r\n    charset: 'utf8'\r\n})))\r\n\r\n\r\n// koa HTTP参数解析\r\nimport bodyParser from 'koa-bodyparser'\r\napp.use(bodyParser({jsonLimit:'2mb'}))\r\n\r\n\r\napp.use(async(ctx, next) => {\r\n    const start = new Date()\r\n    await next()        \r\n    const ms = new Date() - start\r\n    const fdate = moment().format('YYYY-MM-DD HH:mm:ss')\r\n\r\n    console.log(`${ctx.method} ${ctx.url} - ${ms} - ${fdate}`)\r\n})\r\n\r\n\r\napp.on(\"error\", function (err, ctx) {\r\n    console.log(err, 'app something error =>');\r\n})\r\n\r\n\r\n// koa 错误处理\r\nimport errorHandler from 'koa-errorhandler'\r\napp.use(convert(errorHandler()))\r\n\r\n\r\n// 应用路由\r\nimport apiRouter from './routers/api'\r\napp.use(apiRouter.routes(), apiRouter.allowedMethods())\r\n\r\nexport default app\r\n"]}